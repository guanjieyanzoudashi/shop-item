<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品详情页</title>
    <link rel="stylesheet" href="css/商城首页.css">
    <link rel="stylesheet" href="css/zoom.css">
    <style>
        *{
            margin: 0;
            padding: 0;
        }


        /*.text{*/
          /**/
       /*}*/

        .shop-message img{
            height: 270px;
            width: 270px;
            margin-left: 20px;
            margin-top: 20px;
        }
        .product{
            margin-left: 30px;
            /*margin-top: 80px;*/

        }
        .goods-message{
            position: absolute;
            width: 800px;
            top:0px;
            margin-left: 300px;
            /*background-color: white;*/
        }
        .goods-message-title{
            font-size: 20px;
            font-family:微软雅黑;
            text-align: center;
        }
        .goods-message p{
            text-align: center;
        }
        .price{
            display: inline-block;
            vertical-align: middle;
            color: #e4393c;
            font-size: 20px;


        }
        .goods-message-price-title{
            width: 72px;
            display: inline;
           font-size: 10px;
            color: #666666;
            padding-left: 10px;
            font-family: simsun;
        }
        .text-input{
            display: block;
            width: 31px;
            height: 32px;
            line-height: 32px;
            top: 1px;
            left: 0;
            text-align: center;
            margin: 0 auto;
            float: left;

        }
        #add-to-cart{
            width: 137px;
            height: 38px;
            float: right;
            background-image: url("//static.360buyimg.com/item/main/1.0.35/css/i/p-btns.png");
            border: 0;

        }

    </style>
</head>
<body>
<div class="top">
    <ul class="slogan" >
        <li>欢迎来到一淘网，阿里巴巴旗下生活省钱利器！</li>
    </ul>
    <ul class="login">
        <li>
            <a href="login.html" name="register">登陆</a>
            <a href="register.html" name="login">注册</a>
        </li>
        <li><a>订单</a></li>
        <li><a name="cart">购物车</a></li>
    </ul>
</div>
<header class="logo">
    <a href="商城首页.html">
        <img src="img/一淘.png">
    </a>
    <div class="input">
        <input class="search">
        <button class="butt">
            <img src="img/search.png" >
        </button>
        <a href="#" class="app" style="width: 310px;margin-left: 550px">
            <img src="img/app.png" >
        </a>
    </div>
    <div class="QR code">
        <img src="//img.alicdn.com/tps/TB1pjAHPXXXXXc_XFXXXXXXXXXX-238-323.png" style="position: absolute;height: 160px;width: 110px;margin-left: 1200px;display: none" class="codeImg" >
    </div>

    <div class="navitor">
        <ul class="oul"></ul>
    </div>

</header>
<!--<div style="background-color: #F6F6F6;height: 50px"></div>-->
<div class="text">
    <div id="product" class="product">

    </div>
</div>
<footer class="bottom">
    <div class="bottom-dl">
        <dl >
            <dt>关于我们</dt>
            <dd><a href="#">关于一淘</a></dd>
            <dd><a href="#">法律声明</a></dd>
            <dd><a href="#">诚聘人才</a></dd>
            <dd><a href="#">廉政邮箱</a></dd>
        </dl>
        <dl>
            <dt>帮助中心</dt>
            <dd><a href="#">新手指南</a></dd>
            <dd><a href="#">关于返利</a></dd>
            <dd><a href="#">关于集分宝</a></dd>
            <dd><a href="#">关于会员特权</a></dd>
            <dd><a href="#">联系客服</a></dd>
        </dl>
        <dl>
            <dt>手机一淘</dt>
            <dd><a href="#"><img src="//img.alicdn.com/tps/TB1pjAHPXXXXXc_XFXXXXXXXXXX-238-323.png" style="height:162px;width: 119px"></a></dd>
        </dl>
        <dl>
            <dt>优惠地图</dt>
            <dd><a href="#">品牌特卖</a></dd>
            <dd><a href="#">限时闪购</a></dd>
        </dl>
        <dl>
            <dt>商家合作</dt>
            <dd><a href="#">报名入口</a></dd>
            <dd><a href="#">商家端问题</a></dd>
        </dl>
    </div>
    <div class="link-list">
        <p class="link-list-p">
            <a href="#">阿里巴巴集团</a>
            <a href="#">淘宝网</a>
            <a href="#">天猫</a>
            <a href="#">聚划算</a>
            <a href="#">全球速卖通</a>
            <a href="#">阿里巴巴国际交易市场</a>
            <a href="#">1688</a>
            <a href="#">阿里妈妈</a>
            <a href="#">阿里旅行·去啊</a>
            <a href="#">万网</a>
            <a href="#">高德</a>
            <a href="#">优视</a>
            <a href="#">友盟</a>
            <a href="#">酷盘</a>
            <a href="#">虾米</a>
            <a href="#">天天动听</a>
            <a href="#">来往</a>
            <a href="#">钉钉</a>
            <a href="#">11 Main</a>
            <a href="#">支付宝</a>
        </p>
        <p class="link-list-copyright">
            Copyright © 2010-2017 ETAO.COM 版权所有
            增值电信业务经营许可证：浙B2-20080224
        </p>
    </div>
</footer>
</body>
<script src="js/myajax.js" charset="utf-8"></script>
<script src="js/zoom.js" charset="utf-8"></script>
<script>
    function getQueString(name){
        var search=location.search.substr(1);
        var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
        var result=search.match(reg);
        if(result===null)return null;
        return decodeURIComponent(result[2]);

    }
    var oUl = document.querySelector('.oul');
    var oA=document.querySelector("a[name=cart]");
    var oLogin=document.querySelector("a[name=login]");
    var oUsername=document.querySelector("a[name=register]");

    myajax.get('http://h6.duchengjiu.top/shop/api_cat.php', {}, function(error, responseText){
        var json = JSON.parse(responseText);
        var data = json.data;
        for (var i = 0; i < data.length; i++) {
            var obj = data[i];
            oUl.innerHTML += `<li><a href="商城首页.html?cat_id=${obj.cat_id}">${ obj.cat_name}</a></li>`;
        }
//        document.querySelector(".top").innerHTML+=`<div class="login"><a href="login.html" name="register">登陆</a><a href="register.html" name="login">注册</a></div>`
        if(localStorage.username){
            oA.href="cart.html";
            oUsername.innerHTML="你好" + localStorage.username;
            oLogin.innerHTML="退出";
            oLogin.onclick=function(){
                localStorage.username="";
                oLogin.href="商城首页.html"
            };
            if( oUsername.innerHTML===("你好" + localStorage.username)){
                oUsername.href="商城首页.html"
            }
        }
        else if(!localStorage.username){
            oA.onclick=function(){
                alert("请先登录");
            }
        }
    });
    var goods_id = getQueryString('goods_id');
    var oUl2=document.querySelector(".oul2");
    var oText=document.querySelector(".text");
    console.log(goods_id);
    var oProduct=document.querySelector(".product");
    myajax.get('http://h6.duchengjiu.top/shop/api_goods.php', {
        // goods_id: goods_id ES5
        goods_id //ES6
    }, function(err, responseText){
        var json = JSON.parse(responseText);
        var obj = json.data[0];
        console.log(json);
        oProduct.innerHTML = `
        <div style="background-color: white;width: 1100px;margin-top: 60px;position: absolute">
        <div id="smallPic" class="smallPic">
      <img src="${obj.goods_thumb}" alt="" class="smallImage">
      <div id="zoom" class="zoom"></div>
        </div>
            <div class="goods-message">
          <h1 class="goods-message-title">${obj.goods_name}</h1>
          <p style="margin-top: 20px">${obj.goods_desc}</p>
            <div style="height: 160px;width:300px;background-color:#F6F6F6;margin: 0 auto">
            <div style="width: 187px;height: 43px;margin: 0 auto;">
          <div class="goods-message-price-title">一 淘 价:</div><strong class="price"> ￥${obj.price}</strong>
           </div>
           <div style="width: 200px;height:70px;margin: 0 auto;margin-top: 40px">
           <input type="text" class="text-input" value="1" name="goods-number">
           <div style="height: 36px;width: 17px;float: left">
           <button style="float: left;height: 18px;width: 17px" name="add">+</button>
           <button style="float: left;height: 18px;width: 17px" name="subtract">-</button>
           </div>
           <input type="button" id="add-to-cart" name="add-to-cart">
           </div>

          </div>
          </div>
        </div>
    <div id="bigPic" class="bigPic"></div>
      `;
        var oAdd=document.querySelector("button[name=add]");
        var oSubtract=document.querySelector("button[name=subtract]");
        var oNumber=document.querySelector("input[name=goods-number]");
        var oAddCard=document.querySelector("input[name=add-to-cart]");

        oAdd.onclick=function(){

            oNumber.value++;
            if( oNumber.value>=10){
                oNumber.value=10
            }
        }
        oSubtract.onclick=function () {
            oNumber.value--;
            if(oNumber.value<=1){
                oNumber.value=1
            }
        }
        zoom(obj.goods_thumb);

        oAddCard.onclick=function(){
            myajax.post('http://h6.duchengjiu.top/shop/api_cart.php?token='+localStorage.token,
                {goods_id, number: oNumber.value},
                function(err, responseText) {
                    var json = JSON.parse(responseText);
                    console.log(json);
                    if (json.code === 0) {
                        alert('添加到购物车成功');
                        location.href="商城首页.html"
                    } if (json.code !== 0) {
                        alert('已经添加到购物车');
                        location.href="商城首页.html"
                    }

                })
        }
    });

//    document.body.onclick = function(event) {
//        event = event || window.event;
//        var target = event.target || event.srcElement;
//        if (target.id === 'add-to-cart') {
//            console.log('添加到购物车');
//            myajax.post('http://h6.duchengjiu.top/shop/api_cart.php?token='+localStorage.token,
//                {goods_id, number:1},
//                function(err, responseText) {
//                    var json = JSON.parse(responseText);
//                    console.log(json);
//                    if (json.code === 0) {
//                        alert('添加到购物车成功');
//                        location.href="商城首页.html"
//                    } if (json.code !== 0) {
//                        alert('已经添加到购物车');
//                        location.href="商城首页.html"
//                    }
//
//                })
//        }
//    }
    var oApp=document.querySelector(".app");
    var code=document.querySelector(".codeImg");
    oApp.onmouseover=function(){
        code.style.display='block';
    }
    oApp.onmouseout=function(){
        code.style.display='none'
    }

//        <div class="goodsName">${obj.goods_name}</div>
//        <div class="price"> ￥:${obj.price}</div>
//    <div id="add"><input type="button" id="add-to-cart" value="添加到购物车"></div>
</script>
</html>
